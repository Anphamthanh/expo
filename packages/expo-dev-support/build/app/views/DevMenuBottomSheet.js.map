{"version":3,"file":"DevMenuBottomSheet.js","sourceRoot":"","sources":["../../../src/app/views/DevMenuBottomSheet.tsx"],"names":[],"mappings":"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","sourcesContent":["import React from 'react';\nimport Animated from 'react-native-reanimated';\nimport BottomSheet from 'reanimated-bottom-sheet';\nimport {\n  Dimensions,\n  EventSubscription,\n  StyleSheet,\n  TouchableWithoutFeedback,\n  View,\n} from 'react-native';\n\nimport * as DevMenu from './DevMenuModule';\nimport DevMenuBottomSheetContext from './DevMenuBottomSheetContext';\n\ntype Props = {\n  uuid: string;\n};\n\nclass DevMenuBottomSheet extends React.PureComponent<Props, any> {\n  ref = React.createRef<BottomSheet>();\n\n  snapPoints = [0, Math.max(BottomSheet.renumber('50%'), 600), '90%'];\n\n  callbackNode = new Animated.Value(0);\n\n  backgroundOpacity = this.callbackNode.interpolate({\n    inputRange: [0, 1],\n    outputRange: [0.5, 0],\n  });\n\n  closeSubscription: EventSubscription | null = null;\n\n  componentDidMount() {\n    this.expand();\n\n    // Before the dev menu can be actually closed, we need to collapse its sheet view,\n    // and this listens for close requests that come from native side to start collapsing the view.\n    // The awaited return value of this listener is then send back as a response\n    // so the native module knows when it can fully close dev menu (detach its root view).\n    this.closeSubscription = DevMenu.listenForCloseRequests(() => {\n      // Unsubscribe immediately so we don't accidentally collapse twice.\n      // Also componentWillUnmount is not called (why?) when the app is hot reloading this component,\n      // despite the componentDidMount is later called after first render.\n      this.unsubscribeCloseSubscription();\n\n      // `collapse` returns a promise, so this `return` is important to finish the close event once the view is fully collapsed.\n      return this.collapse();\n    });\n  }\n\n  componentDidUpdate(prevProps) {\n    // Make sure it gets expanded once we receive new identifier.\n    if (prevProps.uuid !== this.props.uuid) {\n      this.expand();\n    }\n  }\n\n  componentWillUnmount() {\n    this.unsubscribeCloseSubscription();\n  }\n\n  collapse = (): Promise<void> => {\n    // @tsapeta: There is a bug in react-native-reanimated@1.7.0 that can be workarounded by calling `snapTo` twice.\n    this.ref.current && this.ref.current.snapTo(0);\n    this.ref.current && this.ref.current.snapTo(0);\n\n    // Use setTimeout until there is a better solution to execute something once the sheet is fully collapsed.\n    return new Promise(resolve => setTimeout(resolve, 300));\n  };\n\n  collapseAndClose = async () => {\n    await this.collapse();\n    await DevMenu.closeAsync();\n  };\n\n  expand = () => {\n    // @tsapeta: There is a bug in react-native-reanimated@1.7.0 that can be workarounded by calling `snapTo` twice.\n    this.ref.current && this.ref.current.snapTo(1);\n    this.ref.current && this.ref.current.snapTo(1);\n  };\n\n  unsubscribeCloseSubscription = () => {\n    if (this.closeSubscription) {\n      this.closeSubscription.remove();\n      this.closeSubscription = null;\n    }\n  };\n\n  onCloseEnd = () => {\n    this.collapseAndClose();\n  };\n\n  providedContext = {\n    expand: this.expand,\n    collapse: this.collapse,\n  };\n\n  renderHeader = () => {\n    return (\n      <View style={styles.bottomSheetHeader}>\n        <View style={styles.bottomSheetHeaderBar} />\n      </View>\n    );\n  };\n\n  renderContent = () => {\n    return <View style={styles.bottomSheetContent}>{this.props.children}</View>;\n  };\n\n  render() {\n    return (\n      <DevMenuBottomSheetContext.Provider value={this.providedContext}>\n        <View style={styles.bottomSheetContainer}>\n          <TouchableWithoutFeedback onPress={this.collapseAndClose}>\n            <Animated.View\n              style={[styles.bottomSheetBackground, { opacity: this.backgroundOpacity }]}\n            />\n          </TouchableWithoutFeedback>\n          <BottomSheet\n            ref={this.ref}\n            initialSnap={0}\n            enabledInnerScrolling={false}\n            overdragResistanceFactor={1.5}\n            snapPoints={this.snapPoints}\n            callbackNode={this.callbackNode}\n            renderHeader={this.renderHeader}\n            renderContent={this.renderContent}\n            onCloseEnd={this.onCloseEnd}\n          />\n        </View>\n      </DevMenuBottomSheetContext.Provider>\n    );\n  }\n}\n\nconst styles = StyleSheet.create({\n  bottomSheetContainer: {\n    flex: 1,\n  },\n  bottomSheetBackground: {\n    flex: 1,\n    backgroundColor: '#000',\n  },\n  bottomSheetHeader: {\n    alignItems: 'center',\n    paddingTop: 10,\n    paddingBottom: 6,\n  },\n  bottomSheetHeaderBar: {\n    flex: 1,\n    width: 40,\n    height: 5,\n    backgroundColor: '#fff',\n    borderRadius: 40,\n    opacity: 0.8,\n  },\n  bottomSheetContent: {\n    height: Dimensions.get('window').height,\n  },\n});\n\nexport default DevMenuBottomSheet;\n"]}